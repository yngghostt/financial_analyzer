# Чат-бот для анализа доходов и расходов на Python

Функции бота:
* Добавление расходов и доходов
* Чтение информации из QR кодов
* Вывод диаграмм со статистикой
* Вывод .xlsx таблиц

Используемые технологии и библиотеки
* Python 3.9
* pyTelegramBotAPI
* SQLAlchemy
* OpenCV
* Pandas
* Matplotlib

# Описание работы

**Принцип работы бота**

Для начала работы в файле bot.py вводится ip и запускается функция main(). База данных инициализируется автоматически. Работа с ботом осуществляется через чат в telegram, через отправку текста, фотографий и нажатия клавиш на Inline клавиатуре

**Схема работы бота**

![схема](https://user-images.githubusercontent.com/70640782/148858724-ae78d5c4-3f08-4edd-a2bf-aa8ddc902aa7.png)

**Структура проекта**

![структура](https://user-images.githubusercontent.com/70640782/148857869-fed9d604-f133-4d02-b8ba-d5a5e35c86c3.png)

**База данных**

База данных реализована при помощи библиотеки SQLAlchemy, что позволяет работать с объектами базы данных как с объектами Python. База данных представлена в виде связанных таблиц. База данных содержит таблицу с информацией о доходах и расходах, таблицу с информацией о пользователях, таблицы с названиями категорий. 

![база](https://user-images.githubusercontent.com/70640782/148859831-301389d2-5c65-46f1-8170-8230e4e7d778.png)

Функции для инициализации и работы с БД находятся в файле module.py

**Работа с командами**

Бот поддеживает команды /start, /help, а также команды /add и /statistics, дублирующие работу через меню

![старт](https://user-images.githubusercontent.com/70640782/148858368-473cb5f5-9fbb-4733-b6d0-e2a55b574a83.png)

**Inline клавиатуры**

Бот использует Inline клавиаутры, что позволяет не засорять переписку и удобно перемещаться по меню. Функции для создания клавиатур хранятся в файле keyboards.py

![клавиатуры](https://user-images.githubusercontent.com/70640782/148858517-5d60939f-62ae-4449-881e-7218da0145c8.png)

**Добавление доходов и расходов**

Позиции всех пользовталей хранятся в базе данных. Добавление позиций происходит по следующей схеме

![добавление](https://user-images.githubusercontent.com/70640782/148858877-80deaabf-225a-4da3-8151-80cd9697f4d0.png)

При добавлении расхода возможно чтение информации из QR кода на чеке, функция для распознавания и чтения находится в файле qr.py. Распознение происходит при помощи библиотеки OpenCV. Изображение обесвечивается и очищается от шумов, затем при помощи встренной функции происходит чтение информации из кода. Обработка фотографии предстаавлена ниже

![чтение](https://user-images.githubusercontent.com/70640782/148859337-11634491-2a9c-448f-80f5-f9ac5bcfcb9d.jpg)

**Вывод статистики**

Выбор информации для вывода статистики осуществляется через меню статистики в боте. Схема меню статистики представлена ниже

![статистика](https://user-images.githubusercontent.com/70640782/148860046-d70b2368-1ba8-4fb6-9fe3-ac4f9ac2e91c.png)

В боте присутсвует 2 вида статистики: по категориям и общая статистика. В статистике по категориям выводятся диаграммы, в общей статистике выводится таблица .xlsx. Доступен выбор периода статистики: месяц или всё время.

Пример общей статистики 

![общ](https://user-images.githubusercontent.com/70640782/148860407-e45614cb-c8dc-4bdd-9b0b-f39c6a03bac9.png)

Пример статистики по категориям

![кат 0](https://user-images.githubusercontent.com/70640782/148860446-3fccc381-803b-4339-9493-ace11b481675.png)

![кат1](https://user-images.githubusercontent.com/70640782/148860463-f6aa0fef-8fe1-47e5-aeb9-e1b0ec8b376a.png)

Круговая диаграмма отображает соотношение затраченной суммы по категориям, стобчатая диаграмма отображает количество позиций по каждой категории

